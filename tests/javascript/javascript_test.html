<!doctype html>
    
<!-- An html page to test the server by querying for and displaying the data.
    To run:
        Run the server.
            In terminal or command line, type in 'python3 run.py' and hit enter
        Open this file in browser.
        The raw data should appear after a moment.
-->

<html lang="en">
<head>
    <title>Javascript Test</title>
    
    <!-- jquery -->
    <script src="jquery-3.1.1.min.js"></script>
     
    <!-- plotly -->
    <script src="plotly-latest.min.js"></script>
    
    <!-- code which makes the plotly heatmap -->
    <script src="myplotly.js"></script>
    

</head>
<body>
    
    <h1>Rendering with Plotly.js</h1>
    
    <p id="status">html loaded</p>
    
    <div id="myDiv" ></div>
                
    <script>
        
        const _url = "http://localhost:5000/jsonp"
        
        //callback function with the object resulting from the json data
        function processJSON(json){
            document.getElementById("status").innerHTML = 'Received data!';
            
            console.log("received json object: " + json);
            
            if ( json.salts.length > 1) {
                console.log("rendering multiple frames...")
                animateHeatmap( "myDiv", json);
                //animateTraces("myTraces", json);
            } else {
                console.log("rendering single frame...")
                heatmap( "myDiv", json);
                
            }
            
        }
        
        function makeAJAX( _layers ) {
            document.getElementById("status").innerHTML = 'Making ajax request...';
        
            /* 'JSON Padded' Cross-origin Ajax request to the server */
            $.ajax({
                url: _url,
                dataType: "jsonp",
                data: { layers: _layers},
                jsonpCallback: "processJSON",
            });
            
            
        }
        
        /* Request a single layer to render a frame */
        makeAJAX( 1 );
        makeAJAX( 40 );

        
        /* request multiple layers to render an animation*/    
 
        document.getElementById("status").innerHTML = 'Awaiting response from ' + _url + '. Make sure the server is running.';

    
    </script>

</body>
</html>
